<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<title>Initialization and main loop : OpenKore source code documentation</title>
	<link rel="stylesheet" type="text/css" href="openkore.css">
	<!-- Fix broken PNG transparency for IE/Win5-6+ -->
	<!--[if gte IE 5.5000]>
	<script type="text/javascript" src="pngfix.js"></script>
	<![endif]-->
</head>

<body>

<div id="title">OpenKore source code documentation</div>

<div id="navigation">
	<ul>
	<li><a href="http://openkore.sourceforge.net/">Main website</a></li>
	<li><a href="index.html">Table of contents</a></li>
	<li><b>Initialization &amp; main loop</b></li>
	</ul>
</div>

<div id="main">


<h1>Initialization &amp; main loop</h1>


<h2>High-level description of what Kore does</h2>

When you start Kore, it first loads configuration and table files. Then 
it connects to the Ragnarok Online server. It will now process all 
data received from the server, and calculate what to do (walking,
attacking monsters, etc.), in an infinite loop (until the user tells
Kore to quit).


<h2>Initialization</h2>

<b>openkore.pl</b> is the main source file. The following image
describes what happens when openkore.pl is run:
<p><img src="overview.png" width="708" height="615" alt="Overview">

The most important actions that Kore performs during initialization are:
<ol>
<li>
	<b>Parse arguments:</b>
	Process any arguments passed to openkore.pl (type "openkore --help" to see a list of arguments).
</li>
<li>
	<b>Start input client:</b>
	Initializes the <a href="Input.html">keyboard input system</a> if the --daemon argument is not given.
</li>
<li>
	<b>Load configuration files/tables:</b>
	Parse and load config/*.txt and tables/*.txt.
</li>
<li>
	<b>Load Tools.dll/Tools.so</b>
</li>
<li>
	<b>Check for new portals</b>
	and compile them if necessary.
</li>
<li>
	<b>Ask for username/password</b>
	if it isn't already set in config.txt.
</li>
<li>
	<b>Initialize variables</b>
</li>
</ol>

After this, it will enter the main loop.


<h2>Main loop</h2>

Every loop in the main loop lasts for less than 0.01 seconds 
(exception: when it's calculating a route it can take a while). In each 
loop, the following things are performed:

<ol>
<li>
	<h4>Re-initialize X-Kore if necessary</h4>
	TODO: document how X-Kore works.
</li>
<li>
	<h4>Read keyboard input</h4>
	If the <a href="Input.html">keyboard input system</a> is initialized (the --daemon argument is not given),
	and there is keyboard input available, then Kore will read the keyboard input and
	process the data with the <code>parseInput()</code> function.
</li>
<li>
	<h4>Process data received from RO server</h4>
	TODO
</li>
<li>
	<h4>AI</h4>

	The AI ("Artificial Intelligence") function calculates what
	actions to perform, when, and in what way. See also
	<a href="artificial-intelligence.html">the page that describes the AI in detail</a>.
</li>
<li>
	<h4>Check connection</h4>
	<code>checkConnection()</code> is called. This function handles connection issues.
	It sets relevant connection variables and re-connects to the server for you if neccessary.
</li>
</ol>


<p><hr><p>

<div id="footer">
	<ul>
	<li><a href="http://validator.w3.org/check?uri=referer" title="Valid HTML 4.01!"><img src="http://www.w3.org/Icons/valid-html401" alt="Valid HTML 4.01!" height="31" width="88"></a></li>
	<li><a href="http://www.mozilla.org/products/firefox/" title="Get Firefox - Take Back the Web"><img width="104" height="32" src="http://www.mozilla.org/products/firefox/buttons/getfirefox_small.png" alt="Get Firefox - Take Back the Web"></a></li>
	<li><a href="http://www.mozilla.org/products/firefox/" title="If you were looking at this page in any browser but Microsoft Internet Explorer, it would look and run better and faster"><img width="45" height="45" src="http://linuxart.com/img/noIE-small.png" alt="If you were looking at this page in any browser but Microsoft Internet Explorer, it would look and run better and faster"></a></li>
	</ul>
</div>

</div>

</body>
</html>
